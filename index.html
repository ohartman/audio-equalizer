<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Equalizer - Professional Spectrum Analyzer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const AudioEqualizer = () => {
          const [isPlaying, setIsPlaying] = useState(false);
          const [isMicActive, setIsMicActive] = useState(false);
          const [sensitivity, setSensitivity] = useState(1.2);
          const [theme, setTheme] = useState('neon');
          const [showSettings, setShowSettings] = useState(false);
          const [audioFile, setAudioFile] = useState(null);
          const [smoothing, setSmoothing] = useState(0.8);

          const canvasRef = useRef(null);
          const audioContextRef = useRef(null);
          const analyserRef = useRef(null);
          const dataArrayRef = useRef(null);
          const sourceRef = useRef(null);
          const animationRef = useRef(null);
          const audioElementRef = useRef(null);
          const streamRef = useRef(null);

          const FREQ_BANDS = 32;

          const themes = {
            neon: {
              bg: 'from-purple-900 via-indigo-900 to-black',
              bars: ['from-cyan-400 to-blue-500', 'from-purple-400 to-pink-500', 'from-green-400 to-emerald-500'],
              glow: 'rgba(139, 92, 246, 0.5)'
            },
            fire: {
              bg: 'from-red-900 via-orange-900 to-black',
              bars: ['from-yellow-400 to-orange-500', 'from-orange-400 to-red-500', 'from-red-400 to-pink-500'],
              glow: 'rgba(249, 115, 22, 0.5)'
            },
            ocean: {
              bg: 'from-blue-900 via-cyan-900 to-black',
              bars: ['from-cyan-300 to-blue-400', 'from-blue-400 to-indigo-500', 'from-teal-400 to-cyan-500'],
              glow: 'rgba(34, 211, 238, 0.5)'
            },
            sunset: {
              bg: 'from-pink-900 via-purple-900 to-black',
              bars: ['from-pink-400 to-purple-500', 'from-orange-400 to-pink-500', 'from-purple-400 to-indigo-500'],
              glow: 'rgba(236, 72, 153, 0.5)'
            }
          };

          // Lucide React icons as inline SVG components
          const Play = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
          );

          const Pause = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <rect x="6" y="4" width="4" height="16"></rect>
              <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
          );

          const Mic = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" y1="19" x2="12" y2="22"></line>
            </svg>
          );

          const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          );

          const Settings = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          );

          useEffect(() => {
            return () => {
              if (animationRef.current) {
                cancelAnimationFrame(animationRef.current);
              }
              if (audioContextRef.current) {
                audioContextRef.current.close();
              }
              if (streamRef.current) {
                streamRef.current.getTracks().forEach(track => track.stop());
              }
            };
          }, []);

          const initAudioContext = () => {
            if (!audioContextRef.current) {
              audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
              analyserRef.current = audioContextRef.current.createAnalyser();
              analyserRef.current.fftSize = 2048;
              analyserRef.current.smoothingTimeConstant = smoothing;
              const bufferLength = analyserRef.current.frequencyBinCount;
              dataArrayRef.current = new Uint8Array(bufferLength);
            }
          };

          const handleFileUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
              setAudioFile(file);
              const url = URL.createObjectURL(file);
              
              if (audioElementRef.current) {
                audioElementRef.current.pause();
              }
              
              audioElementRef.current = new Audio(url);
              audioElementRef.current.crossOrigin = "anonymous";
              
              initAudioContext();
              
              if (sourceRef.current) {
                sourceRef.current.disconnect();
              }
              
              sourceRef.current = audioContextRef.current.createMediaElementSource(audioElementRef.current);
              sourceRef.current.connect(analyserRef.current);
              analyserRef.current.connect(audioContextRef.current.destination);
              
              audioElementRef.current.play();
              setIsPlaying(true);
              setIsMicActive(false);
              visualize();
            }
          };

          const toggleMicrophone = async () => {
            if (isMicActive) {
              if (streamRef.current) {
                streamRef.current.getTracks().forEach(track => track.stop());
              }
              setIsMicActive(false);
              setIsPlaying(false);
              if (animationRef.current) {
                cancelAnimationFrame(animationRef.current);
              }
            } else {
              try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                streamRef.current = stream;
                
                initAudioContext();
                
                if (sourceRef.current) {
                  sourceRef.current.disconnect();
                }
                
                sourceRef.current = audioContextRef.current.createMediaStreamSource(stream);
                sourceRef.current.connect(analyserRef.current);
                
                setIsMicActive(true);
                setIsPlaying(true);
                if (audioElementRef.current) {
                  audioElementRef.current.pause();
                }
                visualize();
              } catch (err) {
                console.error('Microphone access denied:', err);
                alert('Microphone access denied. Please allow microphone access in your browser settings.');
              }
            }
          };

          const togglePlayPause = () => {
            if (audioElementRef.current) {
              if (isPlaying) {
                audioElementRef.current.pause();
                setIsPlaying(false);
              } else {
                audioElementRef.current.play();
                setIsPlaying(true);
                visualize();
              }
            }
          };

          useEffect(() => {
            if (analyserRef.current) {
              analyserRef.current.smoothingTimeConstant = smoothing;
            }
          }, [smoothing]);

          const visualize = () => {
            const canvas = canvasRef.current;
            if (!canvas || !analyserRef.current) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            const draw = () => {
              animationRef.current = requestAnimationFrame(draw);

              analyserRef.current.getByteFrequencyData(dataArrayRef.current);

              ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
              ctx.fillRect(0, 0, width, height);

              const barWidth = (width / FREQ_BANDS) * 0.8;
              const gap = (width / FREQ_BANDS) * 0.2;

              for (let i = 0; i < FREQ_BANDS; i++) {
                const dataIndex = Math.floor((i / FREQ_BANDS) * dataArrayRef.current.length);
                const barHeight = (dataArrayRef.current[dataIndex] / 255) * height * sensitivity;

                const x = i * (barWidth + gap) + gap / 2;
                const y = height - barHeight;

                const gradient = ctx.createLinearGradient(x, y, x, height);
                const colors = themes[theme].bars;
                const colorIndex = i % colors.length;
                const colorGradient = colors[colorIndex];
                
                if (colorGradient.includes('cyan')) {
                  gradient.addColorStop(0, '#22d3ee');
                  gradient.addColorStop(1, '#3b82f6');
                } else if (colorGradient.includes('purple')) {
                  gradient.addColorStop(0, '#c084fc');
                  gradient.addColorStop(1, '#ec4899');
                } else if (colorGradient.includes('green')) {
                  gradient.addColorStop(0, '#4ade80');
                  gradient.addColorStop(1, '#10b981');
                } else if (colorGradient.includes('yellow')) {
                  gradient.addColorStop(0, '#facc15');
                  gradient.addColorStop(1, '#f97316');
                } else if (colorGradient.includes('orange')) {
                  gradient.addColorStop(0, '#fb923c');
                  gradient.addColorStop(1, '#ef4444');
                } else if (colorGradient.includes('red')) {
                  gradient.addColorStop(0, '#f87171');
                  gradient.addColorStop(1, '#ec4899');
                } else if (colorGradient.includes('pink')) {
                  gradient.addColorStop(0, '#ec4899');
                  gradient.addColorStop(1, '#a855f7');
                } else if (colorGradient.includes('blue')) {
                  gradient.addColorStop(0, '#60a5fa');
                  gradient.addColorStop(1, '#6366f1');
                } else if (colorGradient.includes('teal')) {
                  gradient.addColorStop(0, '#2dd4bf');
                  gradient.addColorStop(1, '#06b6d4');
                }

                ctx.shadowBlur = 20;
                ctx.shadowColor = themes[theme].glow;
                ctx.fillStyle = gradient;
                
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth, barHeight, [4, 4, 0, 0]);
                ctx.fill();

                ctx.shadowBlur = 0;
                const reflectionHeight = barHeight * 0.3;
                const reflectionGradient = ctx.createLinearGradient(x, height, x, height + reflectionHeight);
                reflectionGradient.addColorStop(0, `${themes[theme].glow.replace('0.5', '0.2')}`);
                reflectionGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                
                ctx.fillStyle = reflectionGradient;
                ctx.beginPath();
                ctx.roundRect(x, height + 2, barWidth, reflectionHeight, [0, 0, 4, 4]);
                ctx.fill();
              }
            };

            draw();
          };

          return (
            <div className={`min-h-screen bg-gradient-to-br ${themes[theme].bg} flex flex-col items-center justify-center p-8`}>
              <div className="w-full max-w-6xl">
                <div className="text-center mb-8">
                  <h1 className="text-5xl font-bold text-white mb-2 tracking-tight">
                    Audio Equalizer
                  </h1>
                  <p className="text-gray-400 text-lg">Professional Spectrum Analyzer</p>
                </div>

                <div className="bg-black/40 backdrop-blur-xl rounded-2xl p-8 shadow-2xl border border-white/10">
                  <canvas
                    ref={canvasRef}
                    width={1200}
                    height={400}
                    className="w-full rounded-lg mb-6"
                    style={{ maxHeight: '400px' }}
                  />

                  <div className="flex flex-wrap gap-4 items-center justify-center mb-6">
                    <label className="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-lg cursor-pointer transition-all flex items-center gap-2 border border-white/20">
                      <Upload size={20} />
                      Upload Audio
                      <input
                        type="file"
                        accept="audio/*"
                        onChange={handleFileUpload}
                        className="hidden"
                      />
                    </label>

                    {audioFile && (
                      <button
                        onClick={togglePlayPause}
                        className="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-lg transition-all flex items-center gap-2 border border-white/20"
                      >
                        {isPlaying && !isMicActive ? <Pause size={20} /> : <Play size={20} />}
                        {isPlaying && !isMicActive ? 'Pause' : 'Play'}
                      </button>
                    )}

                    <button
                      onClick={toggleMicrophone}
                      className={`${
                        isMicActive ? 'bg-red-500 hover:bg-red-600' : 'bg-white/10 hover:bg-white/20'
                      } text-white px-6 py-3 rounded-lg transition-all flex items-center gap-2 border border-white/20`}
                    >
                      <Mic size={20} />
                      {isMicActive ? 'Stop Mic' : 'Use Microphone'}
                    </button>

                    <button
                      onClick={() => setShowSettings(!showSettings)}
                      className="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-lg transition-all flex items-center gap-2 border border-white/20"
                    >
                      <Settings size={20} />
                      Settings
                    </button>
                  </div>

                  {showSettings && (
                    <div className="bg-white/5 rounded-lg p-6 space-y-6 border border-white/10">
                      <div>
                        <label className="text-white block mb-2 text-sm font-medium">
                          Sensitivity: {sensitivity.toFixed(1)}x
                        </label>
                        <input
                          type="range"
                          min="0.5"
                          max="3"
                          step="0.1"
                          value={sensitivity}
                          onChange={(e) => setSensitivity(parseFloat(e.target.value))}
                          className="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer accent-purple-500"
                        />
                      </div>

                      <div>
                        <label className="text-white block mb-2 text-sm font-medium">
                          Smoothing: {smoothing.toFixed(1)}
                        </label>
                        <input
                          type="range"
                          min="0"
                          max="0.95"
                          step="0.05"
                          value={smoothing}
                          onChange={(e) => setSmoothing(parseFloat(e.target.value))}
                          className="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer accent-purple-500"
                        />
                      </div>

                      <div>
                        <label className="text-white block mb-3 text-sm font-medium">Theme</label>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                          {Object.keys(themes).map((themeName) => (
                            <button
                              key={themeName}
                              onClick={() => setTheme(themeName)}
                              className={`px-4 py-2 rounded-lg capitalize transition-all ${
                                theme === themeName
                                  ? 'bg-white/30 text-white border-2 border-white/50'
                                  : 'bg-white/10 text-gray-300 border border-white/20 hover:bg-white/20'
                              }`}
                            >
                              {themeName}
                            </button>
                          ))}
                        </div>
                      </div>
                    </div>
                  )}
                </div>

                <div className="text-center mt-6">
                  <p className="text-gray-500 text-sm">
                    {isMicActive ? 'üé§ Live microphone input active' : audioFile ? `üéµ ${audioFile.name}` : '‚¨ÜÔ∏è Upload audio or use microphone to begin'}
                  </p>
                </div>
              </div>
            </div>
          );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AudioEqualizer />);
    </script>
</body>
</html>
